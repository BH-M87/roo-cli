# Roo CLI 更新日志

Roo CLI 的所有重要更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)，
此项目遵循 [语义化版本控制](https://semver.org/spec/v2.0.0.html)。

## [未发布]

### 新增

- 增强 `--structured-output` 参数以支持文件输出

  - 扩展 `--structured-output` 以接受文件路径进行文件输出
  - 支持控制台输出模式（`--structured-output`）和文件输出模式（`--structured-output <file-path>`）
  - 文件输出包含全面的执行信息：进度、步骤、日志、统计信息和最终结果
  - 任务执行期间实时文件更新，便于监控长时间运行的任务
  - 自动为输出文件路径创建目录
  - 使用文件模式时简化控制台输出，改善用户体验
  - 添加 `FileOutputManager` 实用类用于管理结构化文件输出
  - 添加 `parseStructuredOutputOption` 实用工具用于解析输出选项
  - 增强错误处理，支持文件输出
  - 更新两种输出模式的示例和文档
  - 非常适合监控、分析、集成和报告用例

- 添加 `--stream-mode` 参数以启用 OpenAI API 调用的流模式

  - 新增 `--stream-mode` 命令行标志以启用 OpenAI API 调用的流模式
  - 对于某些仅支持流模式的模型（如 Qwen）是必需的
  - 根据模型名称自动检测需要流模式的模型
  - 正确处理流式响应并将其聚合为单个响应
  - 添加到所有使用 OpenAI API 的命令中

- 添加 `--input-file` 参数从文件读取需求

  - 新增 `--input-file` 命令行标志以指定包含提示/需求的文件
  - 允许从文本文件读取复杂或冗长的需求
  - 适用于在多次运行中重复使用相同需求
  - 支持相对和绝对文件路径
  - 与所有其他命令行选项配合使用
  - 为文件读取操作提供详细的错误处理

- 添加 `--only-return-last-result` 参数用于连续执行模式

  - 新增 `--only-return-last-result` 命令行标志以抑制中间结果
  - 仅返回连续执行的最后结果
  - 适用于脚本和自动化，其中只需要最终结果
  - 与连续和自动模式配合使用
  - 减少长时间运行任务的终端结果噪音

- 添加 `--log-level` 参数以控制输出详细程度

  - 新增 `--log-level` 命令行标志以设置日志级别
  - 支持数值（0-5）和命名级别（debug、info、success、warn、error、always）
  - 添加新的 `always` 级别，仅显示来自 `logger.always()` 调用的输出
  - 提供对输出详细程度的精细控制
  - 替换之前的 `--verbose` 和 `--quiet` 参数
  - 适用于需要特定输出级别的脚本和自动化
  - 添加到 `roo tool` 命令以控制工具执行详细程度
  - 集中式日志系统，在所有命令中提供一致的级别控制

- 添加 MCP SSE 服务器实现

  - 新增 `roo mcp-sse` 命令以启动 MCP SSE 服务器
  - 允许 Web 应用程序和 HTTP 客户端通过 SSE 连接到 Roo CLI
  - 提供 `/sse` 端点用于建立连接
  - 提供 `/messages` 端点用于客户端到服务器的通信
  - 通过 MCP 协议支持所有 Roo 工具和任务创建功能
  - 包含对跨域请求的适当 CORS 支持

- 添加 MCP stdio 服务器实现

  - 新增 `roo mcp-stdio` 命令以启动 MCP stdio 服务器
  - 允许其他服务通过标准输入/输出流连接到 Roo CLI
  - 通过 MCP 协议支持所有 Roo 工具和任务创建功能
  - 正确处理工具调用的所有参数格式
  - 包含使用 Zod 模式的全面参数验证
  - 支持所有任务参数，包括 auto、continuous、max_steps、rules 等

- 添加从先前任务继续的支持

  - 新增 `--continue-from-task` 命令行参数以从先前任务继续执行
  - 任务 ID 包含在每个任务执行的输出中，便于引用
  - 任务在执行之间持久化，允许多步骤工作流
  - 与单步和连续执行模式配合使用

- 新增 `auto` 模式，允许 AI 自动执行任务而无需用户确认
  - 添加 `--auto` 命令行标志以启用自动模式
  - 添加在任务配置文件中设置 `auto: true` 的支持
  - 更新系统提示以在自动模式下运行时通知 AI
  - 自动模式可与连续执行结合使用，实现完全自动化的工作流
- 新增 `rules` 参数，允许用户补充自己的规则
  - 添加 `--rules` 命令行标志以指定自定义规则
  - 添加在任务配置文件中设置 `rules` 的支持
  - 自定义规则附加到系统提示中的默认规则
  - 规则可用于强制执行特定的编码标准或实践
- 新增 `roleDefinition` 参数，允许用户覆盖默认角色定义
  - 添加 `--role-definition` 命令行标志以指定自定义角色定义
  - 添加在任务配置文件中设置 `roleDefinition` 的支持
  - 自定义角色定义替换系统提示中的默认角色定义
  - 角色定义可用于更改 AI 的个性或专业知识
- 改进模式特定设置处理
  - CLI 现在自动使用当前模式的 `customInstructions` 和 `roleDefinition` 作为默认值
  - 这允许定义模式特定的行为，而无需每次都指定它们
  - 优先级顺序：命令行参数 > 任务配置 > 模式设置 > 默认值
- 添加新的 `debug` 模式

  - 专门用于分析和修复代码问题的模式
  - 帮助识别静态代码中的问题、解决编译错误和排除运行时异常
  - 遵循系统化的调试方法

- 添加新的 `orchestrator` 模式
  - 专门用于协调复杂工作流的模式
  - 将任务委托给适当的专门模式
  - 将复杂问题分解为离散任务
  - 跟踪和管理所有子任务的进度
  - 综合结果并提供全面概述
  - 帮助用户了解不同子任务如何配合
  - 基于已完成的子任务建议工作流改进

### 更改

- 改进日志系统

  - 通过统一的 `logger` 实用工具集中日志控制
  - 用适当的日志方法替换直接的 `console.log` 调用
  - 添加 `logger.setLevel` 方法以便于日志级别控制
  - 移除冗余的 `verbose` 参数，改用日志级别控制
  - 改进工具执行的调试输出
  - 在所有命令和工具中保持一致的日志格式
  - 更好地控制脚本和自动化的输出详细程度

- 改进 API 服务器实现

  - 添加对跨域请求的 CORS 支持
  - 增强健康检查端点，提供更详细的信息
  - 在根路径添加 API 信息端点
  - 添加工具端点以列出可用工具
  - 改进错误处理和日志记录
  - 添加对环境变量配置的支持
  - 更好的服务器启动和关闭处理

- 移除旧的 MCP 服务器实现

  - 移除 `mcp-start`、`mcp-stop`、`mcp-restart` 和 `mcp-status` 命令
  - 替换为更专门的 `mcp-sse` 和 `mcp-stdio` 命令
  - 更新文档以反映这些更改

- 将 `SessionManager` 重命名为 `TaskManager`，以更好地与以任务为中心的术语保持一致

  - 从 `session.ts` 移动到 `task-manager.ts`
  - 重命名相关接口和方法以保持一致性
  - 通过使用 taskId 作为主要标识符简化代码

- 在 `task.ts` 中集中任务创建和管理

  - 单步和连续执行模式现在都使用相同的任务创建逻辑
  - 改进代码组织并减少重复
  - 增强任务持久化，以便在执行之间更好地保持连续性

- 将单步执行模式提取到专用的 `SingleStepExecutor` 类中

  - 与 `ContinuousExecutor` 保持一致的架构，以便更好地维护
  - 不同执行模式之间的关注点清晰分离
  - 简化两种执行模式中的任务处理

- 重构 `ContinuousExecutor` 以重用 `SingleStepExecutor` 进行每个执行步骤

  - 消除执行模式之间的代码重复
  - 改进任务执行方式的一致性
  - 更好地遵循 DRY（不要重复自己）原则
  - 优化为仅在连续执行的第一步中添加用户消息

- 在 `searchFilesTool` 中使 `regex` 参数可选
  - 工具现在支持仅基于 `filePattern` 过滤文件
  - 更新工具描述以澄清 regex 是可选的
  - 添加不使用 regex 参数的工具使用示例
  - 改进新功能的测试覆盖率

### 文档

- 更新 README.md 和 README.zh-CN.md，添加新的 `orchestrator` 模式信息
- 添加使用编排器模式进行复杂工作流的示例
- 更新 README.md 和 README.zh-CN.md，添加 `--input-file` 参数信息
- 在英文和中文文档中添加从文件读取需求的示例
- 更新 README.md 和 README.zh-CN.md，添加 MCP SSE 服务器信息
- 添加使用不同配置的 MCP SSE 服务器示例
- 更新 API 服务器文档以反映新端点和功能
- 更新 README.md，添加自动模式信息
- 添加使用不同配置的自动模式示例
- 更新 .rooTask 文件示例以包含 auto 属性

## [1.0.0] - 2025-04-13

### 新增

- Roo CLI 初始发布
- 支持从命令行执行 AI 任务
- 与 OpenAI 和 Anthropic 模型集成
- 文件操作：读取、写入、搜索和列出文件
- 带有批准系统的命令执行
- 连续执行模式
- 通过命令行选项和配置文件进行配置
